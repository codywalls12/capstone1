<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <title>Graph Sonification</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'graph/style.css' %}">
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <!-- <link rel="stylesheet" href="style.css"> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>
<body>
    
    <div id = "canvasContainer"></div>
    
    

    <div class="navbar">
        <a href="{% url 'graph:index' %}">
            <img src="https://i.ibb.co/pZZRGV0/logo-removebg-preview.png" border="0" alt="Logo for the website. Has the team name: Syntax Squad in a circle with a graph depicting sound waves behind it" height="60" width="100">        
        </a>

    </div>
    <div class="content-container" width = "400" height = "400">


       

        <!-- 
            <form action = "{% url 'graph:excel_upload' %}" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form }}
            <button type="submit">Upload Excel File</button>
        </form>
        -->

        <div class="left-half">   
            <div class="upload-container">
                <span class="upload-icon">ðŸ“„</span>
                <p>Browse your device to upload files</p>
                <form action = "{% url 'graph:excel_upload' %}" method="post" enctype="multipart/form-data" id = "uploadForm" class = "formClass">
                
                <div class="drop-zone">
                    <span class="drop-zone__prompt"> Drop File Here or Click To Upload </span>
                    {% csrf_token %}
                    <input type = "file" name = "myFile" class = "drop-zone__input">
                    
                </div>
                <!-- <button type="submit" class = "submitFormButton"> [TEST FORM]</button> -->
                </form>
                
                <div class = "circle" id = "circle1"> Bar Graph</div>
                <div class = "circle" id = "circle2"> Pie Chart</div>
                <div class = "circle" id = "circle3"> Scatter Plot</div>
                

                <script>
                    document.querySelectorAll(".drop-zone__input").forEach(inputElement => {
                        const dropZoneElement = inputElement.closest(".drop-zone");

                        dropZoneElement.addEventListener("click", e => {
                            inputElement.click();
                        });

                        inputElement.addEventListener("change", e => {
                            if (inputElement.files.length) {
                                updateThumbnail(dropZoneElement, inputElement.files[0]);
                            }
                        });

                        dropZoneElement.addEventListener("dragover", e => {
                            e.preventDefault();
                            dropZoneElement.classList.add("drop-zone--over");
                        });

                        ["dragleave", "dragend"].forEach(type => {
                            dropZoneElement.addEventListener(type, e => {
                                dropZoneElement.classList.remove("drop-zone--over");
                            });
                        });

                        dropZoneElement.addEventListener("drop", e => {
                            e.preventDefault();
                            if (e.dataTransfer.files.length) {
                                inputElement.files = e.dataTransfer.files;
                                updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
                            }
                            dropZoneElement.classList.remove("drop-zone--over");
                        });

                        
                        

                        function updateThumbnail(dropZoneElement, file) {
                            let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");

                            if (dropZoneElement.querySelector(".drop-zone__prompt")) {
                                dropZoneElement.querySelector(".drop-zone__prompt").remove();
                            }

                            if (!thumbnailElement) {
                                thumbnailElement = document.createElement("div");
                                thumbnailElement.classList.add("drop-zone__thumb");
                                dropZoneElement.appendChild(thumbnailElement);   
                            }

                            thumbnailElement.dataset.label = file.name;

                            const fileSizeElement = document.createElement("div");
                            fileSizeElement.textContent = formatFileSize(file.size);
                            thumbnailElement.appendChild(fileSizeElement);

                            thumbnailElement.innerHTML = `
                            <div>${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>`;

                            if (file.name.toLowerCase().endsWith(".xlsx")) {
                                alert("excel file has been accepted");
                                const reader = new FileReader();
                                reader.onload = function (e) {
                                    const data = new Uint8Array(e.target.result);
                                    const workbook = XLSX.read(data, { type: "array" });
                                    const sheetName = workbook.SheetNames[0];
                                    const sheet = workbook.Sheets[sheetName];
                                    const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                                    console.log("excel data", jsonData);

                                    // assuming that the first row contains labels and the rest contains actual data
                                    const labels = jsonData[0];
                                    const values = jsonData[1];
                                    //createBarChart(labels, values, file.name);
                                    //createPieChart(labels, values, file.name);
                                    //createScatterPlot(labels, values, file.name);

                                    document.getElementById('circle1').addEventListener('click', function() {
                                
                                
                                createBarChart(labels, values, file.name);
                                //lastClickedCircle = 'circle1';
                            });

                            document.getElementById('circle2').addEventListener('click', function() {
                               
                                
                                createPieChart(labels, values, file.name);
                                //lastClickedCircle = 'circle2';
                            });


                                };
                                reader.readAsArrayBuffer(file);
                            } else {
                                alert("please drop an excel file");
                            }
                            console.log("labels test");
                            
                            console.log("values test");
                            
                            let lastClickedCircle = null;

                            




                            //prototype 1 for creating bar graph
                            function createBarChart(labels, values, file) {
                                var container = document.getElementById("canvasContainer");
                                var canvas = document.createElement("canvas");
                                canvas.id = "myCanvas";
                                canvas.width = 1000;
                                canvas.height = 1000;
                                //const ctx = document.getElementById("myChart").getContext('2d');
                                var ctx = canvas.getContext('2d');
                                container.appendChild(canvas);
                                
                                const myBarChart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: file,
                                            data: values,
                                            backgroundColor: 'rgba(75,192,192,1)',
                                            borderColor:'rgba(75,192,192,1)',
                                            borderWidth: 1
                                        }]

                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                title: {
                                                    beginAtZero: true,
                                                    text: 'y value here'
                                                }
                                            }
                                        }
                                    }, 
                                    layout: {
                                        padding : {
                                            top: 20,
                                            bottom: 20,
                                            left: 20,
                                            right: 20
                                        }
                                    }, 
                                    layout: {
                                        padding : {
                                            top: 20,
                                            bottom: 20,
                                            left: 20,
                                            right: 20
                                        }
                                    }
                                });
                                
                                
                            }

                            //prototype 1 for creating pie graph
                            function createPieChart(labels, values, file) {
                                var container = document.getElementById("canvasContainer");
                                var canvas = document.createElement("canvas");
                                canvas.id = "myCanvas";
                                canvas.width = 1000;
                                canvas.height = 1000;
                                //const ctx = document.getElementById("myChart").getContext('2d');
                                var ctx = canvas.getContext('2d');
                                container.appendChild(canvas);
                                
                                const myPieChart = new Chart(ctx, {
                                    type: 'pie',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: file,
                                            data: values,
                                            backgroundColor: 'rgba(75,192,192,1)',
                                            borderColor:'rgba(75,192,192,1)',
                                            borderWidth: 1
                                        }]

                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                title: {
                                                    beginAtZero: true,
                                                    text: 'y value here'
                                                }
                                            }
                                        }
                                    }, 
                                    layout: {
                                        padding: {
                                            top: 20,
                                            bottom: 20,
                                            left: 20,
                                            right: 20
                                        }
                                    }, 
                                    layout: {
                                        padding: {
                                            top: 20,
                                            bottom: 20,
                                            left: 20,
                                            right: 20
                                        }
                                    }
                                });
                            }


                            

                            function scatterPlot(labels, values, file) {

                            }
                            

                            function formatFileSize(size) {
                                const kb = size / 1024;
                                if (kb < 1024) {
                                    return kb.toFixed(2) + "kb";
                                } else {
                                    const mb = kb / 1024;
                                    return mb.toFixed(2) + "mb";
                                }
                            }
                        }
                    });

		            function defaultMode() {
                        let elementBody = document.body;
                        elementBody.className = "body";

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/SfDTf84/step1.jpg";
                        image2.src = "https://i.ibb.co/4m4ddWD/step2.jpg";
                        image3.src = "https://i.ibb.co/jvmLfpF/step3.jpg";
                    }
                    function darkMode() {
                        let elementBody = document.body;
                        //const elementBody = document.getElementById("darkmode");
                        let content = document.getElementById("darkmodeID"); //html id name
                        elementBody.className = "darkmode"; //css class name
                        content.innerText = "Dark Mode"; //testing

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image2.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image3.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                    }
                    function protanopiaMode() {
                        let elementBody = document.body;
                        elementBody.className = "protanopia";

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image2.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image3.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                    }
                    function deuteranopiaMode() {
                        let elementBody = document.body;
                        elementBody.className = "deuteranopia";

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image2.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image3.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                    }
                    function tritanopiaMode() {
                        let elementBody = document.body;
                        elementBody.className = "tritanopia";

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image2.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image3.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                    }
                    function monochromaMode() {
                        let elementBody = document.body;
                        elementBody.className = "monochroma";

                        let image1 = document.getElementById("step1");
                        let image2 = document.getElementById("step2");
                        let image3 = document.getElementById("step3");
                        image1.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image2.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                        image3.src = "https://i.ibb.co/pZZRGV0/logo-removebg-preview.png";
                    }
                </script>
            </div>
        </div>
        
        <div class="form-container">
                <h2>Graph Settings</h2>

                <form action="{% url 'graph:graph_creation' %}" method="post">
                    {% csrf_token %}
                    <fieldset class="form" id="inputFields">
                        <label for="graph_name">Enter Graph Name</label>
                        <input type="text" name="graph_name" id="graph_name">

			<label for="X_name">Enter X Values Name</label>
                        <input type="text" name="X_name" id="graph_name">

			<label for="Y_name">Enter Y Values Name</label>
                        <input type="text" name="Y_name" id="graph_name">

                        <label for="xy_values">Enter X and Y values</label>
                        <div class="xy-container" id="xy_container">
                            <div>
                                <input type="text" name="x_values[]" class="xy-input" placeholder="X">
                                <input type="text" name="y_values[]" class="xy-input" placeholder="Y">
                            </div>
                        </div>
                        <button class="new-button" type="button" onclick="addInput()">Add X and Y Values</button>

                    </fieldset>

                    <button class="new-button" type="submit">Create Graph</button>
                </form>
            </div>
        <div class="right-half">
            <div class="step-container">
                <img id="step1" class="step1" src="https://i.ibb.co/SfDTf84/step1.jpg" alt="step1" border="0">
                <img id="step2" class="step2" src="https://i.ibb.co/4m4ddWD/step2.jpg" alt="step2" border="0">
                <img id="step3" class="step3" src="https://i.ibb.co/jvmLfpF/step3.jpg" alt="step3" border="0">
            </div>
        </div>

<div class="dropdown">
  <button class="dropbutton">Settings</button>
  <div class="dropdown-content">
    <!-- <a href="#" onclick="defaultMode()">Default</a>
    <a href="#" onclick="darkMode()">Dark Mode</a>
    <a href="#" onclick="protanopiaMode()">Protanopia</a>
    <a href="#" onclick="deuteranopiaMode()">Deuteranopia</a>
    <a href="#" onclick="tritanopiaMode()">Tritanopia</a> -->
    <button id="bodyID" onclick="defaultMode()">Default</button>
    <button id="darkmodeID" onclick="darkMode()">Dark Mode</button>
    <button id="protanopiaID" onclick="protanopiaMode()">Protanopia</button>
    <button id="deuteranopiaID" onclick="deuteranopiaMode()">Deuteranopia</button>
    <button id="tritanopiaID" onclick="tritanopiaMode()">Tritanopia</button>
    <button id = "monochromaID" onclick="monochromaMode()">Monochroma</button>
  </div>
  
</div>

<div class = "screenReaderSwitch"> 
    <label> Screen Reader </label>
    <label class="switch">
        <input type="checkbox" id="toggleSlider">
        <span class="slider"></span>
      </label>
    </div>

    </div>


	<script>

const toggleSlider = document.getElementById('toggleSlider');
toggleSlider.addEventListener('change', function() {
  // Toggle your functionality here
  if (this.checked) {
    // Slider is checked (ON) state
    console.log('Slider is ON');
  } else {
    // Slider is unchecked (OFF) state
    console.log('Slider is OFF');
  }
});

        function addInput() {
            const container = document.getElementById("xy_container");
            const inputDiv = document.createElement("div");

            const inputX = document.createElement("input");
            inputX.type = "number";
            inputX.name = "x_values[]";
            inputX.classList.add("xy-input");
            inputX.placeholder = "X";

            const inputY = document.createElement("input");
            inputY.type = "text";
            inputY.name = "y_values[]";
            inputY.classList.add("xy-input");
            inputY.placeholder = "Y";

 	    inputDiv.appendChild(inputX);
            inputDiv.appendChild(inputY);
            container.appendChild(inputDiv);
        }
    	</script>
  
	

    <!--
    <body> 
        <button id="csv-dropzone" type="file">
            Drop excel file here
        </button>
        <script>
            const csvDropzone = document.getElementById("csv-dropzone"); 

            csvDropzone.addEventListener("dragover", function (event) { 
                event.preventDefault(); 
                csvDropzone.classList.add("dragover"); 
            }); 

            csvDropzone.addEventListener("dragleave", function (event) { 
                event.preventDefault(); 
                csvDropzone.classList.remove("dragover"); 
            }); 

            csvDropzone.addEventListener("drop", function (event) { 
                event.preventDefault(); 
                csvDropzone.classList.remove("dragover"); 
                const csvFile = event.dataTransfer.files[0]; 

                if (csvFile.name.toLowerCase().endsWith(".csv") ||  
                    csvFile.name.toLowerCase().endsWith(".xlsx")) { 
                    alert("csv file has been selected"); 
                    handleCsvFile(csvFile); 
                } else { 
                    alert("Please drop a CSV file."); 
                } 
            }); 
        </script>
    </body>

    <head> 
        <title>csv file</title> 
        <link rel="stylesheet" href= 
    "https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css" /> 
        <script src= 
    "https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"> 
          </script> 
    </head> 

    <body> 
        <form id="csv-upload-form"> 
            <div class="dropzone" id="csv-dropzone"> 
                <div class="dz-message"> 
                    Drop CSV file here 
                </div> 
            </div> 
        </form> 

        <script> 
            const csvDropzone = new Dropzone("#csv-dropzone", { 
                url: "/upload", 
                acceptedFiles: ".csv, xls, xlsx", 
                maxFiles: 1, 
                init: function () { 
                    this.on("success", function (file, response) { 
                        console.log(response); 
                    }); 
                } 
            }); 
        </script> 
    </body>
    -->
    <form action = "{% url 'graph:excel_upload' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form }}
        <button type="submit">Upload Excel File</button>
    </form>
</body>
</html>
